<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球高中新颖洞察</title>
    <!-- Google Fonts: Inter and Noto Sans SC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon/NIGH.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        .dashboard-container {
            margin-top: 60px;
            padding: 20px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--vp-c-text-light-1);
        }

        .dashboard-header .showTime {
            font-size: 1rem;
            color: var(--vp-c-text-light-2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        /* On screens wide enough for 2 columns */
        @media (min-width: 800px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* On screens wide enough for 3 columns */
        @media (min-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* On very wide screens, show all 4 charts in a single row */
        @media (min-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: repeat(4, 1fr) !important;
            }
        }

        .dashboard-chart-container {
            background: var(--vp-c-bg-elv);
            border-radius: var(--vp-radius);
            padding: 20px;
            box-shadow: var(--vp-shadow-2);
            border: 1px solid var(--vp-c-border);
            transition: var(--transition);
            min-width: 0; /* Allow flexing below content size */
        }

        .dashboard-chart-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--vp-shadow-4);
        }

        .chart-header {
            margin-bottom: 15px;
        }

        .chart-header h2 {
            font-size: 1.5rem;
            color: var(--vp-c-text-light-1);
            margin: 0;
        }

        .chart-container {
            width: 100%;
            height: 400px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }
        }

        .map-container {
            width: calc(100% - 20px);
            margin: 1rem auto 4rem; /* Increased bottom margin for more space below map */
            border-radius: var(--vp-radius);
            overflow: hidden;
            box-shadow: var(--vp-shadow-2);
            max-width: var(--container-width);
        }

        .map-container iframe {
            width: 100%;
            min-height: 600px;
            border: none;
        }

        @media (max-width: 768px) {
            .map-container iframe {
                min-height: 450px;
            }
        }

        /* AI智能搜索样式 */
        .search-container {
            position: relative;
            max-width: 600px;
            margin: 20px auto;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            width: 100%;
        }

        #search-input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
            flex: 1; /* Take up remaining space */
        }

        #search-input:focus {
            border-color: #1e80ff;
        }


        /* 热搜下拉列表（微博风格） */
        .hot-search-dropdown {
            position: absolute;
            top: calc(100% + 8px); /* Position directly below the search input with a small gap */
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
            width: 100%; /* Match the search input width */
        }

        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-header h4 {
            margin: 0;
            font-size: 16px;
        }

        .refresh-btn {
            color: #1e80ff;
            cursor: pointer;
            font-size: 14px;
        }

        .hot-list {
            padding: 8px 0;
        }

        .hot-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .hot-item:hover {
            background: #f5f5f5;
        }

        .hot-rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
            color: #ff3852;
            font-size: 18px;
        }

        .hot-content {
            flex: 1;
        }

        .hot-title {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .hot-stats {
            font-size: 12px;
            color: #999;
        }

        #search-btn {
            margin-left: 10px;
            padding: 0 24px;
            background: #1e80ff;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
            height: 40px; /* Match the input height */
            align-self: center; /* Align with the input */
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <a href="{{ url_for('index') }}" class="nav-brand-link">
                    <img src="{{ url_for('static', filename='img/favicon/NIGH.png') }}" alt="NIGH Logo" class="logo">
                    <h1>全球高中新颖洞察</h1>
                </a>
            </div>
            <div class="nav-center">
                <div class="nav-links">
                    <a href="{{ url_for('index') }}" class="nav-link">首页</a>
                    <a href="#" class="nav-link">功能</a>
                    <a href="#" class="nav-link">数据</a>
                    <a href="#" class="nav-link">AI解读</a>
                </div>
            </div>
            <div class="auth-buttons">
                <div class="theme-toggle" id="theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-icon-when-light">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-icon-when-dark">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x1="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </div>
                <a href="{{ url_for('login') }}" class="btn btn-outline">登录</a>
                <a href="{{ url_for('register') }}" class="btn btn-primary">注册</a>
            </div>
            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
        <div class="mobile-menu" id="mobile-menu">
            <button class="close-menu" id="close-menu-btn">✕</button>
            <div class="mobile-theme-toggle">
                <div class="theme-toggle" id="mobile-theme-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-icon-when-light">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-icon-when-dark">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </div>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link">首页</a>
                <a href="#" class="nav-link">功能</a>
                <a href="#" class="nav-link">数据</a>
                <a href="#" class="nav-link">AI解读</a>
            </div>
            <div class="auth-buttons">
                <a href="{{ url_for('login') }}" class="btn btn-outline">登录</a>
                <a href="{{ url_for('register') }}" class="btn btn-primary">注册</a>
            </div>
        </div>
        <div class="mobile-menu-backdrop" id="mobile-menu-backdrop"></div>
    </header>

    <main class="dashboard-container">
        <div class="dashboard-header">
            <h1>数据可视化仪表板</h1>
            <div class="showTime" id="currentTime"></div>

            <!-- AI智能搜索框 -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="请输入搜索内容..."
                        autocomplete="off"
                    />
                    <button id="search-btn">搜索</button>
                </div>
                <!-- 热搜下拉列表（微博风格） -->
                <div id="hot-search-dropdown" class="hot-search-dropdown">
                    <div class="dropdown-header">
                        <h4>热搜榜</h4>
                        <div class="refresh-btn">换一换</div>
                    </div>
                    <div class="hot-list"></div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- 左上角 - 各国学校数量饼图 -->
            <div class="dashboard-chart-container">
                <div class="chart-header">
                    <h2>各国学校数量</h2>
                </div>
                <div class="chart-container" id="schoolCountChart"></div>
            </div>

            <!-- 右上角 - 学费统计柱状图 -->
            <div class="dashboard-chart-container">
                <div class="chart-header">
                    <h2>学费统计情况</h2>
                </div>
                <div class="chart-container" id="tuitionChart"></div>
            </div>

            <!-- 左下角 - 学科开设情况气泡图 -->
            <div class="dashboard-chart-container">
                <div class="chart-header">
                    <h2>学科开设情况统计</h2>
                </div>
                <div class="chart-container" id="subjectChart"></div>
            </div>

            <!-- 右下角 - 学校存在时间折线图 -->
            <div class="dashboard-chart-container">
                <div class="chart-header">
                    <h2>学校存在时间统计</h2>
                </div>
                <div class="chart-container" id="ageChart"></div>
            </div>
        </div>
    </main>

    <!-- Amap iframe below the dashboard charts -->
    <div class="map-container">
        <iframe src="https://ditu.amap.com/" width="100%" frameborder="0"></iframe>
    </div>

    <!-- 引入 ECharts 库 -->
    <script src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>

    <!-- MD3 Extended FAB 搜索按钮样式 -->
    <style>
        .search-extended-fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 1000;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 64px;
            min-width: 64px;
            padding: 0 28px;
            border: none;
            border-radius: 16px; /* MD3 Extended FAB corner radius */
            color: white;
            background: linear-gradient(135deg, #0066cc, #33ccff);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            font-family: var(--vp-font-family-base);
            font-size: 18px;
            font-weight: 500;
            transition: all 0.2s ease;
            gap: 8px;
        }

        .dark .search-extended-fab {
            background: linear-gradient(135deg, #004d99, #0099cc);
        }

        .search-extended-fab:hover {
            background: linear-gradient(135deg, #0080ff, #66ddff);
            box-shadow: 0 4px 16px rgba(0,0,0,0.25), 0 8px 24px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        .dark .search-extended-fab:hover {
            background: linear-gradient(135deg, #0066cc, #33ccff);
        }

        .search-extended-fab:active {
            transform: translateY(0);
        }

        .search-extended-fab .material-icons {
            font-size: 20px;
        }

        /* 响应式调整：在较小的屏幕上 slightly adjust button */
        @media (max-width: 768px) {
            .search-extended-fab {
                bottom: 24px;
                right: 24px;
                height: 60px;
                padding: 0 24px;
            }
        }

        .search-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .search-box {
            background: var(--vp-c-bg-elv);
            padding: 24px;
            border-radius: 28px; /* MD3 dialog corner radius */
            width: 90%;
            max-width: 640px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.22);
            position: relative;
            border: 1px solid var(--vp-c-border);
            min-width: 300px;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .search-title {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--vp-c-text-light-1);
        }

        .search-info-text {
            color: var(--vp-c-text-light-2);
            font-size: 0.875rem;
            margin-bottom: 16px;
            text-align: center;
        }

        .search-info-text .login-link {
            color: var(--vp-c-blue);
            text-decoration: none;
            font-weight: 500;
            margin: 0 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-info-text .login-link:hover {
            color: var(--vp-c-blue-light);
            text-decoration: underline;
        }

        .search-input-container {
            position: relative;
            margin-bottom: 24px;
        }

        .search-input {
            width: 100%;
            padding: 16px 16px 16px 48px; /* Left padding for icon */
            font-size: 16px;
            border: 1px solid var(--vp-c-border);
            border-radius: 4px;
            background-color: var(--vp-c-bg);
            color: var(--vp-c-text-light-1);
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--vp-c-blue);
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
        }

        .search-input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--vp-c-text-light-2);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            width: 24px;
            pointer-events: none;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* Custom scrollbar for MD3 style */
        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .search-results::-webkit-scrollbar-track {
            background: var(--vp-c-bg-mute);
            border-radius: 4px;
        }

        .search-results::-webkit-scrollbar-thumb {
            background: var(--vp-c-gray-light-3);
            border-radius: 4px;
        }

        .search-results::-webkit-scrollbar-thumb:hover {
            background: var(--vp-c-gray-light-2);
        }

        .result-item {
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background-color 0.2s ease;
        }

        .result-item:hover {
            background-color: var(--vp-c-bg-mute);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-title {
            font-weight: 500;
            color: var(--vp-c-text-light-1);
            margin-bottom: 4px;
            font-size: 16px;
        }

        .result-content {
            color: var(--vp-c-text-light-2);
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .close-search {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            border: none;
            color: var(--vp-c-text-light-2);
            font-size: 24px;
            transition: all 0.2s ease;
        }

        .close-search:hover {
            background-color: var(--vp-c-bg-mute);
            color: var(--vp-c-text-light-1);
        }

        .search-loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .material-icons.spin {
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- MD3 Extended FAB 搜索按钮 -->
    <button class="search-extended-fab" id="searchTrigger" title="点击搜索">
        <span class="material-icons">auto_awesome</span>
        <span>AI 智能搜索</span>
    </button>

    <div class="search-modal" id="searchModal">
        <div class="search-box">
            <div class="search-header">
                <div class="search-title">智能搜索</div>
                <button class="close-search" id="closeSearch" type="button">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="search-info-text">
                请<a href="/login" class="login-link">登录</a>以启用 AI
            </div>
            <div class="search-input-container">
                <span class="search-input-icon">
                    <span class="material-icons">search</span>
                </span>
                <input type="text" class="search-input" id="searchInput" placeholder="输入关键词搜索..." autocomplete="off" />
            </div>
            <div class="search-loading" id="searchLoading">
                <span class="material-icons spin" style="font-size: 36px; color: var(--vp-c-blue);">autorenew</span>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>

    <!-- 页面脚本 -->
    <script>
        // 实时时间更新
        function updateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('currentTime').textContent =
                `当前时间: ${year}年${month}月${day}日 ${hours}时${minutes}分${seconds}秒`;
        }

        // 搜索功能
        function setupSearch() {
            const searchTrigger = document.getElementById('searchTrigger');
            const searchModal = document.getElementById('searchModal');
            const closeSearch = document.getElementById('closeSearch');
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');

            // 打开搜索框
            searchTrigger.addEventListener('click', function() {
                searchModal.style.display = 'flex';
                searchInput.focus();
            });

            // 关闭搜索框
            closeSearch.addEventListener('click', function() {
                searchModal.style.display = 'none';
                searchInput.value = '';
                searchResults.innerHTML = '';
            });

            // 点击模态框背景关闭
            searchModal.addEventListener('click', function(e) {
                if (e.target === searchModal) {
                    searchModal.style.display = 'none';
                    searchInput.value = '';
                    searchResults.innerHTML = '';
                }
            });

            // 搜索输入事件
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const query = this.value.trim();

                if (query.length === 0) {
                    searchResults.innerHTML = '';
                    document.getElementById('searchLoading').style.display = 'none';
                    return;
                }

                // 延迟搜索，避免频繁请求
                searchTimeout = setTimeout(() => {
                    performSearch(query);
                }, 500);
            });

            // 执行搜索
            async function performSearch(query) {
                // 显示加载指示器，隐藏结果区域
                document.getElementById('searchLoading').style.display = 'block';
                searchResults.innerHTML = '';

                try {
                    const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                    const results = await response.json();

                    // 隐藏加载指示器，显示结果
                    document.getElementById('searchLoading').style.display = 'none';
                    displaySearchResults(results);
                } catch (error) {
                    console.error('搜索出错:', error);
                    // 隐藏加载指示器，显示错误信息
                    document.getElementById('searchLoading').style.display = 'none';
                    searchResults.innerHTML = '<div class="result-item">搜索出现错误，请稍后再试</div>';
                }
            }

            // 显示搜索结果
            function displaySearchResults(results) {
                searchResults.innerHTML = '';

                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="result-item">未找到相关结果</div>';
                    return;
                }

                results.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <div class="result-title">${result.title || '无标题'}</div>
                        <div class="result-content">${result.content ? result.content.substring(0, 100) + '...' : ''}</div>
                    `;
                    resultItem.addEventListener('click', function() {
                        // 在新页面中打开文章详情
                        window.open(`/article/${result.id}`, '_blank');
                    });
                    searchResults.appendChild(resultItem);
                });
            }
        }

        // 初始调用并设置定时器
        updateTime();
        setInterval(updateTime, 1000);

        // 初始化 ECharts 图表和搜索功能
        window.onload = function() {
            setupSearch();

            // 各国学校数量饼图
            const schoolCountChart = echarts.init(document.getElementById('schoolCountChart'));
            const schoolCountOption = {
                title: {
                    text: '共统计排名前180所',
                    subtext: '',
                    left: 'center',
                    top: 10
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    top: '10%'
                },
                series: [
                    {
                        name: '地区学校数量',
                        type: 'pie',
                        radius: '60%',
                        center: ['60%', '50%'],
                        data: [
                            { value: 79, name: '美国' },
                            { value: 15, name: '中国' },
                            { value: 1, name: '加拿大' },
                            { value: 73, name: '英国' },
                            { value: 1, name: '印度' },
                            { value: 10, name: '日本' },
                            { value: 2, name: '韩国' },
                            { value: 1, name: '阿联酋' },
                            { value: 2, name: '新加坡' },
                            { value: 1, name: '瑞士' }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            schoolCountChart.setOption(schoolCountOption);

            // 学科开设情况气泡图
            const subjectChart = echarts.init(document.getElementById('subjectChart'));
            const dataMath = [
                [1, 95, 4.2, 85, 88, 90, 8, '数学'],
                [2, 78, 3.1, 70, 72, 75, 6, '应用数学'],
                [3, 82, 3.5, 75, 77, 80, 7, '概率论'],
                [4, 90, 4.0, 82, 84, 87, 8, '几何学'],
                [5, 65, 2.5, 60, 65, 68, 5, '数学史'],
                [6, 85, 3.7, 78, 80, 83, 7, '代数学'],
                [7, 92, 4.1, 85, 87, 90, 8, '统计学'],
                [8, 70, 2.8, 65, 68, 70, 5, '数论'],
                [9, 88, 3.9, 80, 82, 85, 7, '微积分'],
                [10, 75, 3.3, 70, 73, 76, 6, '线性代数'],
                [11, 80, 3.4, 72, 75, 78, 6, '数学分析'],
                [12, 60, 2.0, 55, 60, 62, 4, '数学竞赛'],
                [13, 87, 3.8, 79, 81, 84, 7, '离散数学'],
                [14, 68, 2.7, 63, 66, 68, 5, '数值分析'],
                [15, 91, 4.2, 84, 86, 89, 8, '数学建模'],
                [16, 55, 1.8, 50, 55, 58, 3, '数学哲学'],
                [17, 83, 3.6, 76, 78, 81, 6, '数学逻辑'],
                [18, 77, 3.2, 71, 74, 77, 6, '数学思维'],
                [19, 89, 4.0, 82, 84, 87, 7, '数学创新'],
                [20, 62, 2.3, 58, 61, 64, 4, '数学应用'],
                [21, 94, 4.3, 87, 89, 92, 8, '高等数学'],
                [22, 72, 2.9, 67, 70, 73, 5, '数学文化'],
                [23, 86, 3.7, 78, 80, 83, 7, '数学实验'],
                [24, 58, 2.1, 53, 56, 59, 4, '数学美学'],
                [25, 96, 4.4, 89, 91, 94, 9, '数学研究'],
                [26, 74, 3.0, 69, 72, 75, 6, '数学教育'],
                [27, 81, 3.5, 74, 76, 79, 6, '金融数学'],
                [28, 67, 2.6, 62, 65, 67, 5, '数学史'],
                [29, 93, 4.2, 86, 88, 91, 8, '数学前沿'],
                [30, 79, 3.4, 73, 76, 79, 6, '数学软件'],
                [31, 84, 3.6, 77, 79, 82, 7, '运筹学']
            ];
            const dataScience = [
                [1, 98, 4.5, 92, 94, 95, 9, '物理'],
                [2, 65, 2.2, 58, 62, 65, 4, '天文学'],
                [3, 91, 4.1, 84, 86, 88, 7, '化学'],
                [4, 58, 1.9, 52, 56, 59, 3, '古生物学'],
                [5, 87, 3.8, 80, 82, 84, 7, '地球科学'],
                [6, 94, 4.3, 87, 89, 91, 8, '生物'],
                [7, 70, 2.8, 64, 67, 70, 5, '气象学'],
                [8, 92, 4.2, 85, 87, 89, 8, '材料科学'],
                [9, 62, 2.4, 56, 59, 62, 4, '能源科学'],
                [10, 89, 4.0, 82, 84, 86, 7, '海洋科学'],
                [11, 75, 3.1, 68, 71, 74, 6, '地质学'],
                [12, 83, 3.5, 76, 78, 81, 6, '环境科学'],
                [13, 55, 1.7, 49, 53, 56, 3, '符号学'],
                [14, 96, 4.4, 89, 91, 93, 9, '生物技术'],
                [15, 68, 2.6, 61, 64, 67, 5, '空间科学'],
                [16, 90, 4.1, 83, 85, 87, 7, '生态学'],
                [17, 72, 2.9, 65, 68, 71, 5, '科学史'],
                [18, 86, 3.7, 79, 81, 84, 7, '微生物学'],
                [19, 60, 2.1, 54, 57, 60, 4, '民俗学'],
                [20, 93, 4.3, 86, 88, 90, 8, '科研方法'],
                [21, 77, 3.2, 70, 73, 76, 6, '科学哲学'],
                [22, 81, 3.4, 74, 77, 79, 6, '科学伦理'],
                [23, 66, 2.5, 60, 63, 66, 5, '科学美学'],
                [24, 95, 4.4, 88, 90, 92, 8, '实验科学'],
                [25, 74, 3.0, 67, 70, 73, 6, '科学计算'],
                [26, 88, 3.9, 81, 83, 85, 7, '科学创新'],
                [27, 53, 1.6, 47, 51, 54, 3, '科学考古'],
                [28, 91, 4.1, 84, 86, 88, 7, '科学实验'],
                [29, 69, 2.7, 63, 66, 69, 5, '科学社会学'],
                [30, 85, 3.6, 78, 80, 83, 6, '科学思维'],
                [31, 79, 3.3, 72, 75, 78, 6, '科学传播']
            ];
            const dataHumanities = [
                [1, 90, 4.1, 88, 86, 85, 8, '中文'],
                [2, 55, 1.8, 50, 54, 57, 3, '古典文献'],
                [3, 85, 3.7, 82, 81, 80, 7, '历史'],
                [4, 62, 2.3, 57, 60, 63, 4, '人类学'],
                [5, 88, 3.9, 85, 84, 82, 7, '英语'],
                [6, 75, 3.1, 71, 74, 77, 6, '哲学'],
                [7, 68, 2.7, 64, 67, 70, 5, '美学'],
                [8, 82, 3.4, 79, 78, 76, 6, '文学'],
                [9, 58, 2.1, 53, 56, 59, 4, '民俗学'],
                [10, 86, 3.6, 83, 82, 80, 7, '艺术'],
                [11, 72, 2.9, 68, 71, 74, 5, '符号学'],
                [12, 80, 3.2, 77, 76, 74, 6, '社会学'],
                [13, 65, 2.5, 61, 64, 67, 5, '宗教'],
                [14, 92, 4.2, 89, 88, 86, 8, '心理学'],
                [15, 53, 1.7, 48, 51, 54, 3, '文献学'],
                [16, 87, 3.8, 84, 83, 81, 7, '古典学'],
                [17, 77, 3.2, 73, 76, 79, 6, '逻辑学'],
                [18, 60, 2.2, 55, 58, 61, 4, '伦理学'],
                [19, 84, 3.5, 81, 80, 78, 6, '语言学'],
                [20, 67, 2.6, 62, 65, 68, 5, '教育学'],
                [21, 89, 4.0, 86, 85, 83, 7, '传播学'],
                [22, 56, 1.9, 51, 54, 57, 3, '跨文化研究'],
                [23, 81, 3.3, 78, 77, 75, 6, '文化研究'],
                [24, 74, 2.9, 70, 73, 76, 5, '文史哲'],
                [25, 63, 2.4, 58, 61, 64, 4, '比较文学'],
                [26, 94, 4.3, 91, 90, 88, 8, '人文社科'],
                [27, 69, 2.7, 65, 68, 71, 5, '科学史'],
                [28, 79, 3.2, 75, 78, 81, 6, '人文教育'],
                [29, 51, 1.5, 46, 49, 52, 3, '伦理学史'],
                [30, 83, 3.4, 80, 79, 77, 6, '音乐'],
                [31, 71, 2.8, 67, 70, 73, 5, '美术']
            ];
            const schema = [
                { name: 'day', index: 0, text: '第' },
                { name: 'offeringRate', index: 1, text: '开设率(%)' },
                { name: 'difficulty', index: 2, text: '难度系数' },
                { name: 'popularity', index: 3, text: '受欢迎度(%)' },
                { name: 'avgScore', index: 4, text: '平均分(%)' },
                { name: 'resourceDemand', index: 5, text: '资源需求(%)' },
                { name: 'qualityLevel', index: 6, text: '教学质量' }
            ];
            const itemStyle = {
                opacity: 0.8,
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowOffsetY: 0,
                shadowColor: 'rgba(0,0,0,0.3)'
            };
            const subjectOption = {
                color: ['#5470c6', '#91cc75', '#fac858'],
                legend: {
                    top: 10,
                    data: ['数学', '理科', '文科'],
                    textStyle: {
                        fontSize: 16
                    }
                },
                grid: {
                    left: '10%',
                    right: 150,
                    top: '18%',
                    bottom: '15%'
                },
                tooltip: {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    formatter: function (param) {
                        const value = param.value;
                        return '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">'
                            + param.seriesName + ' - ' + value[7] + '<br/>'
                            + '开设率：' + value[1] + '%<br/>'
                            + '难度系数：' + value[2] + '<br/>'
                            + '受欢迎度：' + value[3] + '%<br/>'
                            + '平均分：' + value[4] + '%<br/>'
                            + '资源需求：' + value[5] + '%<br/>'
                            + '教学质量：' + value[6] + '分'
                            + '</div>';
                    }
                },
                xAxis: {
                    type: 'value',
                    name: '开设率(%)',
                    nameGap: 16,
                    nameTextStyle: {
                        fontSize: 16
                    },
                    min: 0,
                    max: 100,
                    splitLine: {
                        show: false
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '平均分(%)',
                    nameLocation: 'end',
                    nameGap: 20,
                    nameTextStyle: {
                        fontSize: 16
                    },
                    min: 0,
                    max: 100,
                    splitLine: {
                        show: false
                    }
                },
                dataZoom: [
                    {
                        type: 'slider',
                        show: true,
                        xAxisIndex: [0],
                        start: 0,
                        end: 100,
                        bottom: '5%',
                        height: 20
                    },
                    {
                        type: 'slider',
                        show: true,
                        yAxisIndex: [0],
                        start: 0,
                        end: 100,
                        right: 120,
                        width: 20
                    },
                    {
                        type: 'inside',
                        xAxisIndex: [0],
                        start: 0,
                        end: 100
                    },
                    {
                        type: 'inside',
                        yAxisIndex: [0],
                        start: 0,
                        end: 100
                    }
                ],
                visualMap: [
                    {
                        left: 'right',
                        top: '10%',
                        dimension: 2,
                        min: 1.5,
                        max: 4.5,
                        itemWidth: 30,
                        itemHeight: 120,
                        calculable: true,
                        precision: 0.1,
                        text: ['圆形大小：难度系数'],
                        textGap: 30,
                        inRange: {
                            symbolSize: [10, 70]
                        },
                        outOfRange: {
                            symbolSize: [10, 70],
                            color: ['rgba(255,255,255,0.4)']
                        },
                        controller: {
                            inRange: {
                                color: ['#c23531']
                            },
                            outOfRange: {
                                color: ['#999']
                            }
                        }
                    },
                    {
                        left: 'right',
                        bottom: '5%',
                        dimension: 5,
                        min: 50,
                        max: 95,
                        itemHeight: 120,
                        text: ['明暗：资源需求'],
                        textGap: 30,
                        inRange: {
                            colorLightness: [0.9, 0.5]
                        },
                        outOfRange: {
                            color: ['rgba(255,255,255,0.4)']
                        },
                        controller: {
                            inRange: {
                                color: ['#c23531']
                            },
                            outOfRange: {
                                color: ['#999']
                            }
                        }
                    }
                ],
                series: [
                    {
                        name: '数学',
                        type: 'scatter',
                        itemStyle: itemStyle,
                        data: dataMath
                    },
                    {
                        name: '理科',
                        type: 'scatter',
                        itemStyle: itemStyle,
                        data: dataScience
                    },
                    {
                        name: '文科',
                        type: 'scatter',
                        itemStyle: itemStyle,
                        data: dataHumanities
                    }
                ]
            };
            subjectChart.setOption(subjectOption);

            // 学费统计柱状图
            const tuitionChart = echarts.init(document.getElementById('tuitionChart'));
            const tuitionOption = {
                title: {
                    text: '',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['学费范围', '学校数量'],
                    top: '10%'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['$0-1万', '$1-2万', '$2-3万', '$3-4万', '$4-5万', '$5万以上']
                },
                yAxis: {
                    type: 'value',
                    name: '学校数量'
                },
                series: [
                    {
                        name: '学校数量',
                        type: 'bar',
                        data: [5, 12, 25, 40, 30, 15],
                        itemStyle: {
                            color: '#5470c6'
                        }
                    }
                ]
            };
            tuitionChart.setOption(tuitionOption);

            // 学校存在时间折线图
            const ageChart = echarts.init(document.getElementById('ageChart'));
            const years = [1950, 1955, 1960, 1965, 1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020];
            const counts = [2, 5, 8, 12, 15, 18, 22, 25, 20, 15, 10, 8, 5, 3, 1];
            const cumulative = [2, 7, 15, 27, 42, 60, 82, 107, 127, 142, 152, 160, 165, 168, 169];
            const ageOption = {
                title: {
                    text: '',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    },
                    formatter: function(params) {
                        let result = `${params[0].name}年<br/>`;
                        params.forEach(param => {
                            const marker = `<span style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:${param.color}"></span>`;
                            if (param.seriesName === '年度成立数量') {
                                result += `${marker}${param.seriesName}: ${param.value}所<br/>`;
                            } else {
                                result += `${marker}${param.seriesName}: ${param.value}所<br/>`;
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['年度成立数量', '累积学校数量'],
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '12%',
                    top: '20%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        data: years,
                        axisPointer: {
                            type: 'shadow'
                        },
                        axisLabel: {
                            interval: Math.ceil(years.length / 10) - 1,
                            rotate: 45
                        }
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        name: '学校数量',
                        min: 0,
                        axisLabel: {
                            formatter: '{value} 所'
                        }
                    },
                    {
                        type: 'value',
                        name: '累积学校数量',
                        min: 0,
                        axisLabel: {
                            formatter: '{value} 所'
                        }
                    }
                ],
                dataZoom: [
                    {
                        type: 'slider',
                        show: true,
                        xAxisIndex: [0],
                        start: 0,
                        end: 100,
                        bottom: '5%'
                    },
                    {
                        type: 'inside',
                        xAxisIndex: [0],
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: '年度成立数量',
                        type: 'bar',
                        data: counts,
                        itemStyle: {
                            color: '#5470c6'
                        },
                        emphasis: {
                            focus: 'series'
                        }
                    },
                    {
                        name: '累积学校数量',
                        type: 'line',
                        yAxisIndex: 1,
                        data: cumulative,
                        itemStyle: {
                            color: '#ee6666'
                        },
                        lineStyle: {
                            width: 3
                        },
                        symbol: 'circle',
                        symbolSize: 6,
                        emphasis: {
                            focus: 'series'
                        }
                    }
                ]
            };
            ageChart.setOption(ageOption);

            // 监听窗口大小变化，调整图表大小
            window.addEventListener('resize', function() {
                schoolCountChart.resize();
                subjectChart.resize();
                tuitionChart.resize();
                ageChart.resize();
            });
        };

        // 热搜功能实现
        class HotSearch {
            constructor() {
                this.searchInput = document.getElementById('search-input');
                this.hotDropdown = document.getElementById('hot-search-dropdown');
                this.hotList = this.hotDropdown.querySelector('.hot-list');
                this.refreshBtn = this.hotDropdown.querySelector('.refresh-btn');
                this.hotData = [];

                this.init();
            }

            async init() {
                // 获取热搜数据
                await this.fetchHotSearchData();

                // 初始化下拉列表
                this.initDropdown();

                // 绑定事件
                this.bindEvents();
            }

            // 模拟获取热搜数据（实际开发中替换为真实API）
            async fetchHotSearchData() {
                // 这里模拟API请求
                this.hotData = [
                    { title: "全球顶尖高中排名", heat: 1250000, rank: 1 },
                    { title: "国际课程体系对比", heat: 980000, rank: 2 },
                    { title: "留学申请趋势分析", heat: 850000, rank: 3 },
                    { title: "高中教育创新模式", heat: 720000, rank: 4 },
                    { title: "全球IB学校分布", heat: 650000, rank: 5 },
                    { title: "AP课程选课指南", heat: 540000, rank: 6 },
                    { title: "国际学校师资力量", heat: 430000, rank: 7 },
                    { title: "高中学生心理健康", heat: 380000, rank: 8 }
                ];
            }

            initDropdown() {
                this.hotList.innerHTML = '';

                this.hotData.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'hot-item';
                    div.innerHTML = `
                        <div class="hot-rank">${item.rank}</div>
                        <div class="hot-content">
                            <div class="hot-title">${item.title}</div>
                            <div class="hot-stats">${this.formatHeat(item.heat)} 热度</div>
                        </div>
                    `;
                    div.dataset.keyword = item.title;
                    this.hotList.appendChild(div);
                });
            }

            bindEvents() {
                // 输入框聚焦时显示下拉列表
                this.searchInput.addEventListener('focus', () => {
                    if (this.searchInput.value === '') {
                        this.hotDropdown.style.display = 'block';
                    }
                });

                // 输入框失焦时隐藏下拉列表
                this.searchInput.addEventListener('blur', (e) => {
                    // 延迟隐藏，确保能点击到热搜词
                    setTimeout(() => {
                        if (!this.hotDropdown.contains(document.activeElement)) {
                            this.hotDropdown.style.display = 'none';
                        }
                    }, 200);
                });

                // Also hide dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.searchInput.contains(e.target) &&
                        !this.hotDropdown.contains(e.target) &&
                        !e.target.closest('#search-btn')) {
                        this.hotDropdown.style.display = 'none';
                    }
                });

                // 点击热搜词
                this.hotList.addEventListener('click', (e) => {
                    const hotItem = e.target.closest('.hot-item');
                    if (hotItem) {
                        const keyword = hotItem.dataset.keyword;
                        this.searchInput.value = keyword;
                        this.performSearch(keyword);
                        this.hotDropdown.style.display = 'none';
                    }
                });

                // 换一换功能
                this.refreshBtn.addEventListener('click', async () => {
                    // 实际开发中重新请求数据
                    await this.fetchHotSearchData();
                    this.initDropdown();
                });

                // 搜索按钮点击
                document.getElementById('search-btn').addEventListener('click', () => {
                    this.performSearch(this.searchInput.value);
                });

                // 回车搜索
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch(this.searchInput.value);
                    }
                });
            }

            performSearch(keyword) {
                if (!keyword.trim()) return;

                console.log('搜索关键词:', keyword);
                // 这里添加实际的搜索逻辑
                // 例如：window.location.href = `/search?q=${encodeURIComponent(keyword)}`;

                // 对于仪表板，我们可以执行特定的搜索功能
                // 这里可以集成到现有的搜索功能或创建新的接口
                fetch(`/search?q=${encodeURIComponent(keyword)}`)
                    .then(response => response.json())
                    .then(results => {
                        console.log('搜索结果:', results);
                        // 可以在这里更新图表或显示结果
                    })
                    .catch(error => {
                        console.error('搜索出错:', error);
                    });
            }

            formatHeat(heat) {
                if (heat >= 10000) {
                    return (heat / 10000).toFixed(1) + '万';
                }
                return heat;
            }
        }

        // 初始化热搜功能
        document.addEventListener('DOMContentLoaded', () => {
            new HotSearch();
        });
    </script>
</body>
</html>